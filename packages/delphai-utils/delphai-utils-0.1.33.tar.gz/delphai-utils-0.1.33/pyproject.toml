[tool.poetry]
name = "delphai-utils"
version = "0.1.33"
description = "delphai backend utilities"
authors = ["Barath Kumar <barath@delphai.com>"]
homepage = "https://github.com/delphai/backend-utils"

[tool.poetry.dependencies]
python = "^3.8"
omegaconf = "^2.0.2"
memoization = "^0.3.1"
python-dotenv = "^0.14.0"
kubernetes = "^11.0.0"
coloredlogs = "^14.0"
deepmerge = "^0.1.0"
grpcio = "^1.32.0"
starlette = "^0.13.8"
hypercorn = "^0.10.2"
validate_email = "^1.3"
ipaddress = "^1.0.23"
jinja2 = "^2.11.2"
markupsafe = "^1.1.1"
starlette-prometheus = "^0.7.0"
grpcio-health-checking = "^1.32.0"
grpcio-reflection = "^1.32.0"
googleapis-common-protos = "^1.52.0"

[tool.poetry.extras]
config = [
  "omegaconf",
  "memoization",
  "python-dotenv",
  "kubernetes",
  "deepmerge"
]

grpc = [
  "grpcio",
  "starlette",
  "hypercorn",
  "validate_email",
  "ipaddress",
  "jinja2",
  "markupsafe",
  "starlette-prometheus",
  "grpcio-health-checking",
  "grpcio-reflection",
  "googleapis-common-protos"
]

[tool.poetry.dev-dependencies]
pytest = "^5.2"
yapf = "^0.30.0"
poethepoet = "^0.8.0"
pytest-watch = "^4.2.0"

[build-system]
requires = ["poetry>=0.12"]
build-backend = "poetry.masonry.api"

[tool.poe.tasks]
test = "ptw -- --verbose"
publish-test = "poetry publish -r testpypi"
publish = [
  {cmd = "poetry version patch"},
  {cmd = "poetry build"},
  {cmd = "poetry publish --username ${PYPI_USERNAME} --password ${PYPI_PASSWORD}"},
  {cmd = "poetry publish --username ${PYPI_USERNAME} --password ${PYPI_PASSWORD} -r testpypi"}
]