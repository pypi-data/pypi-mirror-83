<tal:ns_global define="formdata python:view.formdata_reviewers();
"><metal:page use-macro="context/pr_master/macros/master"
            i18n:domain="vdz.projectreview">
<!DOCTYPE html>
<html lang="en">

<head>
    <title>WiTraBau Review-Management</title>

    <!-- Meta data -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="WiTraBau Review-Management">
    <meta name="author" content="visaplan GmbH">

    <!-- Styles -->
    <metal:head-insertions fill-slot="head_slot">
    <link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet"
          tal:replace="nothing" />
    <link href="./css/panel.css" rel="stylesheet"
          tal:attributes="href string:/++resource++panel.css"
          />
    <link href="./lib/chosen/chosen.css" rel="stylesheet"
          tal:replace="nothing" />
    <script src="../static/projectreview.js"></script>
    </metal:head-insertions>
</head>

<body>

    <!-- page wrapper and container -->
<metal:content fill-slot="pr-main"
><tal:ns define="
action formdata/action | string:view;
current_reviewers formdata/current_reviewers | nothing;
current_rv formdata/current_rv | nothing;
editperm python:current_rv and 'edit' or 'create';
may_edit python:permission[editperm];
readonly python:action == 'view' or not may_edit;
subproject_id current_rv/id | nothing;
make_view_links request/make_view_links | python:False;
omit_view_links not:make_view_links;
sp_macros context/pr_subprojects/macros;
">
    <div class="wrap">
    <div>

    <!-- CONTENT START -->

    <tal:hint condition="python:0">
    <div class="alert alert-warning" role="alert">Bearbeitung durch Review-Koordinator</div>

    <br/><hr/>
    </tal:hint>

    <h1>Review-Stellen</h1>

    <form tal:condition="permission/create"
         >
    <input type="hidden" name="id" value="42"
           tal:attributes="value project_id">
    <button class="btn btn-primary"
            type="submit"
            name="action" value="create">
        <i class="icon-plus icon-white"></i>
        Neue Review-Stelle zuweisen
    </button>
    </form>

    <div class="panel panel-info"
         metal:use-macro="sp_macros/info-panel">
    <div class="panel-heading"
         metal:fill-slot="heading">Erfasste Review-Stellen</div>
    <div class="panel-body">
    <h2>Projekt Akronym Titel</h2>
    <p>Untertitel</p>
    <p>Bekanntmachung</p>
    <p>Laufzeit</p>
    <p>Verbundkoordinator</p>
    </div>

    <table class="table table-default"
           metal:fill-slot="list">
        <tbody tal:define="
        common string:?id=$project_id;
        can_edit permission/edit;
        is_admin current_user/is_admin;
        can_appoint permission/appoint;
        member_of current_user/member_of;
        make_final_link formdata/meta/make_final_link;
        ">
        <tr tal:define="rk_text string:Aktueller Review-Koordinator;
                        make_rk_url string:/@@projectreview/make_rk"
            tal:repeat="row current_reviewers">
            <tal:row-ns define="
            is_coordinator row/is_coordinator;
            is_own python:member_of[path('row/member_id')];
            ">
            <td tal:content="repeat/row/number">
                1
            </td>
            <td tal:content="row/member_acronym">Review-Stelle 1</td>
            <td tal:content="row/role_label">
                Review-Koordinator
            </td>
            <td>
                <a href=""
                   tal:condition="can_edit"
                   tal:attributes="href string:pr_reviewers${common}&partner_id=${row/partner_id}"
                   >Eintrag bearbeiten</a>
            </td>
            <td>
                <a href="pr_result.html"
                   tal:condition="python:is_own or is_admin"
                   tal:attributes="href string:pr_result?partner_id=${row/partner_id}&is_final=False"
                   >Review-Formular</a>
            </td>
            <td tal:condition="make_final_link">
                <tal:if-is-coordinator condition="is_coordinator">
                <tal:ns-final define="
                final_id row/review_id_final;
                make_link python:final_id or member_of[path('row/member_id')];"
                condition="make_link">
                <a href="#"
                   tal:define="url python:(final_id
                                           and 'pr_result?review_id=%(review_id_final)d'
                                           or  'pr_result?partner_id=%(partner_id)d&is_final=True'
                                           ) % row"
                   tal:attributes="href url">
                   Finales Review
                </a>
                </tal:ns-final>
                </tal:if-is-coordinator>
            </td>
            <td>
                <a href="#"
                   title="Zum Review-Koordinator machen"
                   tal:condition="python:is_coordinator or can_appoint"
                   tal:omit-tag="python:is_coordinator or not can_appoint"
                   tal:attributes="href string:$make_rk_url?partner_id=${row/partner_id}">
                   Review-Koordinator
               </a>
            </td>
            <td tal:define="title python:is_coordinator and 'Aktueller Review-Koordinator' or None"
                tal:attributes="title title">
                <i class="icon-ok"
                   tal:condition="is_coordinator"></i>
            </td>
            </tal:row-ns>
        </tr>
        </tbody>
    </table>
    </div>

    <tal:if-details condition="python:current_rv or action == 'create'">
    <br/><hr/>

    <h2 tal:condition="python:action == 'create'">
        Review-Stelle erfassen
    </h2>
    <h2 tal:condition="python:action == 'edit'">
        Review-Stelle bearbeiten
    </h2>
    <h2 tal:condition="python:action == 'view'">
        Review-Stelle
    </h2>

    <form action="@@projectreview/action_reviewers" method="post"
          tal:omit-tag="readonly">
        <input type="hidden" name="project_id" value="42"
               tal:attributes="value project_id">
        <div class="form-group">
            <label for="a1">WiTraBau-Projektpartner</label>
            <select data-placeholder="Choose one ..."
                    i18n:attributes="data-placeholder"
                    name="member_id"
                    class="chosen-select form-control"
                    tal:define="
                    values formdata/pool/reviewers;
                    curval current_rv/group_id | nothing;
                    ">
                <option tal:condition="not:values"
                        disabled="disabled">
                    Keine Reviewer konfiguriert
                </option>
                <tal:has-reviewers condition="values">
                <option value=""></option>
                <tal:reviewers-loop repeat="row values">
                <option value="1"
                        tal:define="
                        value row/group_id;
                        selected python:value == curval;
                        member_acronym row/member_acronym;
                        "
                        tal:attributes="
                        value value;
                        selected selected;
                        "
                        tal:content="member_acronym"
                        >DAfStb</option>
                </tal:reviewers-loop>
                </tal:has-reviewers>
                <tal:prototype replace="nothing">
                <option value="2">VDZ</option>
                <option value="3">DBV</option>
                <option value="4">FTB</option>
                <option value="5">FGSV</option>
                <option value="6">IBP</option>
                <option value="7">IRB</option>
                </tal:prototype>
            </select>
        </div>

        <metal:buttons use-macro="context/pr_main/macros/detail-form-buttons">
        <button type="submit" class="btn btn-primary">Eingabe speichern</button>
        <button type="submit" class="btn btn-default">Datensatz l√∂schen</button>
        </metal:buttons>
    </form>
    </tal:if-details>

    <!-- CONTENT END -->

    </div><!-- /container -->
    </div><!-- /wrap -->


<tal:prototype replace="nothing">
    <!-- JavaScript  -->
    <script src="./lib/jquery/jquery-1.10.1.min.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.min.js"></script>
    <!--<script src="./bootstrap-vp/js/bootstrap-sortable.js"></script>-->
    <script src="./lib/chosen/chosen.jquery.js" type="text/javascript"></script>
</tal:prototype>

</tal:ns>
</metal:content>
</body>
</html><!-- vim: set ts=4 sts=4 sw=4 si noet: --></metal:page></tal:ns_global>
